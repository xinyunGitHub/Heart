{"remainingRequest":"/Users/wind/Documents/Heart/Heart/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wind/Documents/Heart/Heart/src/views/Detail.vue?vue&type=style&index=0&id=40f4caea&lang=less&scoped=true&","dependencies":[{"path":"/Users/wind/Documents/Heart/Heart/src/views/Detail.vue","mtime":1604459893909},{"path":"/Users/wind/Documents/Heart/Heart/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wind/Documents/Heart/Heart/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/wind/Documents/Heart/Heart/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/wind/Documents/Heart/Heart/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wind/Documents/Heart/Heart/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wind/Documents/Heart/Heart/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLmRldGFpbCB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIHdpZHRoOiAxMDAlOwogIG1pbi1oZWlnaHQ6IDEwMHZoOwogIGJhY2tncm91bmQtY29sb3I6ICNmNWY1ZjU7CiAgLmRldGFpbC1zd2lwZSB7CiAgICB3aWR0aDogMTAwJTsKICAgIGhlaWdodDogMzc1cHg7CiAgICAudmFuLXN3aXBlLWl0ZW0gewogICAgICB3aWR0aDogMTAwJTsKICAgICAgaGVpZ2h0OiAzNzVweDsKICAgICAgPiBpbWcgewogICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgIGhlaWdodDogMzc1cHg7CiAgICAgIH0KICAgIH0KICB9CiAgLmRldGFpbC1wcmljZSB7CiAgICBwYWRkaW5nOiAwIDE2cHg7CiAgICBsaW5lLWhlaWdodDogMjRweDsKICAgID4gYiB7CiAgICAgIGZvbnQtc2l6ZTogMTRweDsKICAgICAgY29sb3I6ICNlZTBhMjQ7CiAgICAgIGZvbnQtd2VpZ2h0OiA0MDA7CiAgICB9CiAgICA+IGVtIHsKICAgICAgZm9udC1zaXplOiAxNnB4OwogICAgICBjb2xvcjogI2VlMGEyNDsKICAgICAgZm9udC13ZWlnaHQ6IDQwMDsKICAgIH0KICAgID4gc3Ryb25nIHsKICAgICAgZm9udC1zaXplOiAyMnB4OwogICAgICBjb2xvcjogI2VlMGEyNDsKICAgICAgZm9udC13ZWlnaHQ6IDUwMDsKICAgIH0KICB9CiAgLmRldGFpbC10aXRsZSB7CiAgICBmb250LXNpemU6IDE2cHg7CiAgICBjb2xvcjogIzMzMzMzMzsKICB9CiAgLmRldGFpbC1xdWFsaXR5IHsKICAgIG1hcmdpbjogMThweCAwIDAgMDsKICB9CiAgLmRldGFpbC1tZXNzYWdlIHsKICAgIG1hcmdpbjogMThweCAwIDAgMDsKICAgIHBhZGRpbmc6IDAgMCA1MHB4IDA7CiAgICA+IGltZyB7CiAgICAgIHdpZHRoOiAxMDAlOwogICAgICBoZWlnaHQ6IGF1dG87CiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["Detail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Detail.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"detail\">\n    <!--【banner图】-->\n    <van-swipe class=\"detail-swipe\" :autoplay=\"3000\" indicator-color=\"white\">\n      <van-swipe-item v-for=\"(item, index) in figureData\" :key=\"index\">\n        <img v-lazy=\"baseUrl + 'storage/' + item.figure\" />\n      </van-swipe-item>\n    </van-swipe>\n    <!--【商品标题和价格】-->\n    <van-cell-group>\n      <div class=\"detail-price\">\n        <b>售价: </b>\n        <em>¥ </em>\n        <strong>{{ informData.price }}</strong>\n      </div>\n      <van-cell :value=\"informData.title\" :border=\"false\" value-class=\"detail-title\" />\n    </van-cell-group>\n    <van-cell-group class=\"detail-quality\">\n      <van-cell title=\"正品保障\" />\n      <van-cell title=\"运费: 包邮\" />\n      <van-cell title=\"7天无理由退货\" />\n    </van-cell-group>\n    <!--【商品详情】-->\n    <van-cell-group class=\"detail-message\">\n      <van-cell title=\"商品详情\" :border=\"false\" />\n      <template v-for=\"(item, index) in thumbData\">\n        <img :key=\"index\" v-lazy=\"baseUrl + 'storage/' + item.describe\" />\n      </template>\n      <van-divider>没有更多啦</van-divider>\n    </van-cell-group>\n    <!--【Sku】-->\n    <van-sku\n      v-model=\"skuDialog\"\n      :sku=\"sku\"\n      :initial-sku=\"initialSku\"\n      :goods=\"informData\"\n      :goods-id=\"informData.unique\"\n      :quota=\"0\"\n      :quota-used=\"0\"\n      :hide-stock=\"false\"\n      @stepper-change=\"skuCount\"\n      @sku-selected=\"skuSelect\"\n      @buy-clicked=\"goBuy\">\n      <template #sku-actions=\"props\">\n        <div class=\"van-sku-actions\">\n          <van-button\n            square\n            size=\"large\"\n            type=\"danger\"\n            @click=\"props.skuEventBus.$emit('sku:buy')\"\n          >\n          立即购买\n          </van-button>\n        </div>\n      </template>\n    </van-sku>\n    <!--【底部固定栏】-->\n    <van-goods-action>\n      <van-goods-action-icon icon=\"chat-o\" text=\"客服\" @click=\"getCustom\" />\n      <van-goods-action-icon icon=\"shop-o\" text=\"店铺\" @click=\"routeHome\" />\n      <van-goods-action-button\n        type=\"danger\"\n        text=\"立即购买\"\n        @click=\"prepareBuy\"\n      />\n    </van-goods-action>\n  </div>\n</template>\n\n<script>\nimport Vue from 'vue';\nimport { Swipe, SwipeItem, Lazyload, Cell, CellGroup, Divider, GoodsAction, GoodsActionIcon, GoodsActionButton, Sku, Button } from 'vant';\nVue.use(Swipe);\nVue.use(SwipeItem);\nVue.use(Lazyload);\nVue.use(Cell);\nVue.use(CellGroup);\nVue.use(Divider);\nVue.use(Sku);\nVue.use(GoodsAction);\nVue.use(GoodsActionButton);\nVue.use(GoodsActionIcon);\nVue.use(Button);\nimport { goodsDetail, goodsSku } from './../assets/api/detail.js'\nexport default {\n  name: 'Detail',\n  data() {\n    return {\n      baseUrl: process.env.VUE_APP_SERVICE,\n      unique: '', // 商品ID\n      gather: '', // 已选规格\n      count: 1, // 已选数量\n      figureData: [],\n      informData: {},\n      thumbData: [],\n      skuDialog: false,\n      sku: {\n        tree: [],\n        list: [],\n        price: '', // 默认价格（单位元）\n        stock_num: 0, // 商品总库存\n        none_sku: false, // 是否无规格商品\n      },\n      initialSku: {}\n    }\n  },\n  created() {\n    this.unique = this.$route.query.unique;\n    this.detailData(this.unique);\n    this.detailSku(this.unique);\n  },\n  methods: {\n    async detailData(unique) {\n      let params = {\n        unique: unique\n      };\n      let result = await goodsDetail(params);\n      if (result.status) {\n        this.figureData = result.data.figure;\n        this.informData = result.data.inform;\n        this.informData['picture'] = this.baseUrl + 'storage/' + this.figureData[0]['figure'];\n        this.thumbData = result.data.thumb;\n        // 初始化sku数据\n        this.sku.price = this.informData.price;\n      }\n    },\n    async detailSku(unique) {\n      let params = {\n        unique: unique\n      };\n      let result = await goodsSku(params);\n      if (result.status) {\n        this.sku.tree = result.data;\n        const group = this.skuList(result.data, 1);\n        const catalog = this.skuList(result.data, 2);\n        this.sku.list = this.skuGroup(group, catalog);\n        this.sku.stock_num = this.totalCount(this.sku.list);\n      }\n    },\n    skuList(tree, typ) {\n      let group = [];\n      tree.map(item => {\n        let single = [];\n        item.v.map(list => {\n          if (typ == 1) {\n            single.push(list.name);\n          } else {\n            single.push(list.id);\n          }\n        })\n        group.push(single);\n      })\n      return this.Cartesian(group);\n    },\n    Cartesian(arr) { // 求笛卡尔值\n      if (arr.length < 2) return arr[0] || [];\n      return arr.reduce((total, value) => {\n        let item = [];\n        total.forEach(c => {\n          value.forEach(v => {\n            if (c instanceof Array) {\n              item.push([...c, v]);\n            } else {\n              item.push([c, v]);\n            }\n          })\n        })\n        return item;\n      })\n    },\n    skuGroup(g, c) {\n      const total = [];\n      c.filter((item, i) => {\n        let li = {};\n        if (item instanceof Array) {\n          item.filter((list, l) => {\n            let key = this.sku.tree[l].k_s;\n            li[key] = list;\n            li['id'] = key * list * (l + i);\n            li['price'] = this.informData.price * 100;\n            li['stock_num'] = list + i + l; // 随便写一个库存\n            li['gather'] = g[i].join('、');\n          })\n        } else {\n          let key = this.sku.tree[0].k_s;\n          li[key] = item;\n          li['id'] = key * item;\n          li['price'] = this.informData.price * 100;\n          li['stock_num'] = item + i; // 随便写一个库存\n          li['gather'] = g[i];\n        }\n        total.push(li);\n      })\n      return total;\n    },\n    totalCount(t) {\n      let r = 0;\n      t.filter(i => {\n        r += i['stock_num'];\n      })\n      return r;\n    },\n    getCustom() {\n      console.log('咨询客服')\n    },\n    routeHome() {\n      this.$router.push({\n        name: 'Home'\n      })\n    },\n    prepareBuy() {\n      this.skuDialog = true;\n    },\n    skuCount(val) {\n      this.count = val;\n    },\n    skuSelect(val) {\n      this.$nextTick(() => {\n        let pricenum = document.getElementsByClassName(\"van-sku__price-num\");\n        pricenum[0].innerHTML = this.informData.price;\n      })\n      if (val.selectedSkuComb) {\n        this.gather = val.selectedSkuComb.gather;\n      } else {\n        this.gather = '';\n      }\n    },\n    goBuy() {\n      console.log('gobuy', this.unique, this.gather, this.count, this.informData);\n      let params = {\n        unique: this.unique,\n        gather: this.gather,\n        count: this.count,\n        title: this.informData.title,\n        price: this.informData.price,\n        picture: this.informData.picture,\n      };\n      this.$store.commit(\"setOrderList\", params);\n      this.$router.push({\n        name: 'Order',\n        query: {\n          unique: this.unique,\n          gather: this.gather,\n          count: this.count\n        }\n      });\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.detail {\n  position: relative;\n  width: 100%;\n  min-height: 100vh;\n  background-color: #f5f5f5;\n  .detail-swipe {\n    width: 100%;\n    height: 375px;\n    .van-swipe-item {\n      width: 100%;\n      height: 375px;\n      > img {\n        width: 100%;\n        height: 375px;\n      }\n    }\n  }\n  .detail-price {\n    padding: 0 16px;\n    line-height: 24px;\n    > b {\n      font-size: 14px;\n      color: #ee0a24;\n      font-weight: 400;\n    }\n    > em {\n      font-size: 16px;\n      color: #ee0a24;\n      font-weight: 400;\n    }\n    > strong {\n      font-size: 22px;\n      color: #ee0a24;\n      font-weight: 500;\n    }\n  }\n  .detail-title {\n    font-size: 16px;\n    color: #333333;\n  }\n  .detail-quality {\n    margin: 18px 0 0 0;\n  }\n  .detail-message {\n    margin: 18px 0 0 0;\n    padding: 0 0 50px 0;\n    > img {\n      width: 100%;\n      height: auto;\n    }\n  }\n}\n</style>"]}]}